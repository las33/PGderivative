<!DOCTYPE html>
<html>
<head>
<script src="http://cdnjs.cloudflare.com/ajax/libs/bonsai/0.4/bonsai.min.js"></script>
<div id="movie"></div>
<script>
  bonsai.run(document.getElementById('movie'), {
    code: function() {
	var points = [];
	var points2 = [];
	var circles = [];
	var circles2 = [];
	var curve = [];
	var canvas1 = {};
	var canvas2 = {};
      
	canvas2 = new Rect(750,0,stage.options.width,stage.options.height);
	canvas2.attr('fillColor', 'black');
	canvas2.addTo(stage);
      
	canvas1 = new Rect(0,0,(stage.options.width/2), stage.options.height);
	canvas1.attr('fillColor', 'white');
	canvas1.addTo(stage);

	function interp(ponto1, ponto2, t){
	  var coord1 = (1-t)*ponto1.x + t*ponto2.x
	  var coord2 = (1-t)*ponto1.y + t*ponto2.y
	  return new Point(coord1,coord2)
	}
	
	function deCasteljau(){
	  curve = []
	  for (var t = 0; t <= 1; t+=0.001) {
		var auxPoints = []
		auxPoints = points
		while (auxPoints.length>1) {
		  var tamanho = auxPoints.length
		  var temp2 = []
		  for (var i = 0; i < tamanho-1; i++) {
			var newPoint = interp(auxPoints[i], auxPoints[i+1], t)
			temp2.push(newPoint)
		  }
		  auxPoints = temp2;
		}
		curve.push(auxPoints[0].x)
		curve.push(auxPoints[0].y)
	  }
	}
	canvas1.on('click', function(e) {
			curve = []
        	points.push(new Point(e.x, e.y))
        	var circ = new Circle(e.x, e.y, 3).fill('navy');
			circles.push(circ);
        	circ.addTo(stage);
		if(circles.length > 1){
			var paths = []
			for(var i=0;i<circles.length-1;i++){
				paths.push(new Path([
					['moveTo', circles[i].attr('x'), circles[i].attr('y')],
					['lineTo', circles[i+1].attr('x'), circles[i+1].attr('y')]				
				]).stroke('green',0.9));			
			}
			if(points.length >= 3){
				deCasteljau()
				paths.push(new Path(curve).stroke('blue', 1))
			}
			var stageObjects = [];
			stageObjects.push(canvas1)
			stageObjects.push(canvas2)
			paths.forEach(function(p){
				stageObjects.push(p);
			});
			circles.forEach(function(c) {
				stageObjects.push(c);
			});
			stage.children(stageObjects);
		}
      	});

	

    },
    width: 1500,
    height: 750
});
</script>
</head>
</html>
